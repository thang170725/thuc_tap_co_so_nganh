{% extends 'base.html' %}
{% load static %}

{% block title %}Quản lý Lớp học{% endblock title %}

<!-- 1. CSS cho Tab Navigation -->
{% block page_css %}
<style>
    .sub-nav { display: flex; background-color: #f8f9fa; border-radius: 5px; margin-bottom: 20px; }
    .sub-nav a {
        padding: 12px 20px;
        text-decoration: none;
        color: #555;
        font-weight: bold;
        border-bottom: 3px solid transparent;
    }
    .sub-nav a.active, .sub-nav a:hover {
        color: #007bff;
        border-bottom-color: #007bff;
    }
</style>
{% endblock %}

<!-- 2. Lấp đầy sidebar của Admin -->
{% block role_specific_links %}
    <div>
        <ul class="main-menu">
            <li><i class="fa-solid fa-people-group"></i>Thông tin
                <ul class="child-menu">
                    <li><a href="{% url 'admin_teacher_infor' %}" class="nav-item">Thông tin giảng viên</a></li>
                    <li><a href="{% url 'admin_student_infor' %}" class="nav-item">Thông tin sinh viên</a></li>
                </ul>
            </li>
        </ul>
    </div>  
    <a href="{% url 'event_management' %}" class="nav-item"><i class="fas fa-calendar-check"></i> Quản lý Sự kiện</a>
    <a href="{% url 'user_list' %}" class="nav-item"><i class="fas fa-users-cog"></i> Quản lý Người dùng</a>
    <!-- Đánh dấu active cho link Quản lý Học vụ -->
    <a href="{% url 'course_list' %}" class="nav-item active"><i class="fas fa-book-open"></i> Quản lý Học vụ</a>
{% endblock role_specific_links %}

<!-- 3. Chèn thông tin User Admin -->
{% block user_info %}
    <div class="get-username">
        Xin chào, {{ user_profile.userId }}<br> 
        <span style="font-size: 16px;">Admin</span>
    </div>
{% endblock user_info %}

<!-- 4. Nội dung chính -->
{% block content %}
<div style="padding: 20px; background-color: white; margin: 20px; border-radius: 8px;">
    
    <h2 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">Quản lý Học vụ</h2>

    <!-- Thanh Tab Navigation (Môn học / Lớp học) -->
    <div class="sub-nav">
        <a href="{% url 'course_list' %}">Phần A: Quản lý Môn học</a>
        <a href="{% url 'class_list' %}" class="active">Phần B: Quản lý Lớp học</a>
        <!-- (Link Phần C sẽ thêm vào đây sau) -->
    </div>
    
    <p style="margin-top: 20px;">
        <a href="{% url 'class_create' %}" style="text-decoration: none; padding: 10px 15px; background-color: #28a745; color: white; border-radius: 5px; font-weight: bold;">
            + Mở Lớp học mới
        </a>
    </p>

    <!-- (Hiển thị messages (nếu có)) -->
    {% if messages %}
        {% for message in messages %}
            <div style="padding: 15px; margin: 20px 0; border-radius: 5px; background-color: {% if message.tags == 'success' %}#d4edda{% else %}#f8d7da{% endif %}; color: {% if message.tags == 'success' %}#155724{% else %}#721c24{% endif %}; border: 1px solid {% if message.tags == 'success' %}#c3e6cb{% else %}#f5c6cb{% endif %};">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Bảng danh sách Lớp học -->
    <table class="table table-striped" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
        <thead>
            <tr style="background-color: #f8f9fa;">
                <th style="padding: 12px; border: 1px solid #ddd;">Mã Lớp</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Tên Môn học</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Giảng viên</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Học kỳ</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Sĩ số</th>
                <th style="padding: 12px; border: 1px solid #ddd;">Hành động</th>
            </tr>
        </thead>
        <tbody>
            {% for class in class_list %}
            <tr>
                <td style="padding: 12px; border: 1px solid #ddd;">{{ class.classId }}</td>
                <td style="padding: 12px; border: 1px solid #ddd;">{{ class.courseId.courseName }}</td>
                <td style="padding: 12px; border: 1px solid #ddd;">{{ class.teacher.fullName }}</td>
                <td style="padding: 12px; border: 1px solid #ddd;">{{ class.semester }}</td>
                <td style="padding: 12px; border: 1px solid #ddd;">{{ class.students_classes_set.count }}</td>                
                <td style="padding: 12px; border: 1px solid #ddd;">
                    <!-- (Chúng ta sẽ tạo link 'manage_students' ở Phần C) -->
                    <a href="{% url 'manage_class_students' class.classId %}" style="color: #0d6efd; text-decoration: none; font-weight: bold;">Gán SV</a>                    
                    <a href="{% url 'class_edit' class.classId %}" style="color: #ffc107; text-decoration: none; font-weight: bold; margin-left: 15px;">Sửa</a>
                    <a href="{% url 'class_delete' class.classId %}" style="color: #dc3545; text-decoration: none; margin-left: 15px; font-weight: bold;">Xóa</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" style="padding: 12px; border: 1px solid #ddd; text-align: center;">Chưa có lớp học nào được mở.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock content %}